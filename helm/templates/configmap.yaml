apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "govault-autounseal.fullname" . }}
  labels:
    {{- include "govault-autounseal.labels" . | nindent 4 }}
data:
  config.yaml: |
    wait_interval: {{ .Values.config.wait_interval }}
    encrypted_keys: {{ .Values.config.encrypted_keys | quote }}
    http_server:
      port: {{ .Values.config.http_server.port }}
    {{- if eq .Values.mode "kube" }}
    kube_config:
      vault_namespace: {{ .Values.kubeConfig.vault_namespace | quote }}
      vault_label_selector: {{ .Values.kubeConfig.vault_label_selector | quote }}
      pod_scan_max_counter: {{ .Values.kubeConfig.pod_scan_max_counter }}
      pod_scan_delay: {{ .Values.kubeConfig.pod_scan_delay }}
      {{- if .Values.encryptionSecret.enabled }}
      secret_name: {{ include "govault-autounseal.fullname" . }}-keys
      {{- else }}
      secret_name: {{ .Values.kubeConfig.secret_name }}
      {{- end }}
      secret_namespace: {{ .Release.Namespace | quote }}
      vault_pod_port: {{ .Values.kubeConfig.vault_pod_port }}
    {{- else if eq .Values.mode "http" }}
    http_config:
      vault_urls:
      {{- range .Values.httpConfig.vault_urls }}
        - {{ . | quote }}
      {{- end }}
      secret_key: {{ .Values.httpConfig.secret_key | quote }}
      secret_salt: {{ .Values.httpConfig.secret_salt | quote }}
    {{- end }}